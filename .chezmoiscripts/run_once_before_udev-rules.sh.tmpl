#!/bin/bash

{{ range .udev.symlinks -}}
SYMLINK_NAME={{ .alias | quote }}
RULE_PATH="/etc/udev/rules.d/${SYMLINK_NAME}-dev-path.rules"
DEVICE_ID=$(lspci -d ::03xx | grep {{ .vendor | quote }} | cut -f1 -d' ')
UDEV_RULE="$(cat <<EOF
KERNEL=="card*", \
KERNELS=="0000:$DEVICE_ID", \
SUBSYSTEM=="drm", \
SUBSYSTEMS=="pci", \
SYMLINK+="dri/$SYMLINK_NAME"
EOF
)"

echo "$UDEV_RULE" | sudo tee "$RULE_PATH"
{{ end -}}

sudo udevadm control --reload
sudo udevadm trigger
